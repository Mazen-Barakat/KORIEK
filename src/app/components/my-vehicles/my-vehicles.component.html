<div class="my-vehicles-page">
  <!-- Left Column: Vehicle Cards -->
  <div class="left-column">
    <!-- Profile Welcome Section -->
    <div class="profile-welcome-section">
      <div class="hero-left">
        <div class="hero-badge">Your Dashboard</div>
        <h1 class="hero-title">
          Welcome Back, <span class="user-name">{{ profileName }}</span>
        </h1>
        <p class="hero-subtitle">
          Your vehicle command center awaits. Monitor, manage, and maintain your fleet with ease.
        </p>
        <div class="hero-stats">
          <div class="stat-item">
            <div class="stat-value">{{ vehicles.length }}</div>
            <div class="stat-label">Active Vehicles</div>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <div class="stat-value">{{ carOwnerProfile?.email ? '‚úì' : '‚Äî' }}</div>
            <div class="stat-label">Verified</div>
          </div>
        </div>
      </div>
      <div class="hero-right">
        <div class="profile-card">
          <img
            [src]="profilePicture"
            alt="Profile Picture"
            class="profile-picture"
            (click)="navigateToProfile()"
            style="cursor: pointer"
            (error)="profilePicture = 'Assets/images/default-profile.svg'"
          />
          <div class="profile-badge">Premium Member</div>
        </div>
      </div>
    </div>

    <div class="vehicles-section">
      <div class="section-header">
        <div class="title-section">
          <div>
            <h1>My Vehicles</h1>
            <p class="subtitle">Monitor and manage your cars</p>
          </div>
        </div>
        <button class="add-car-btn" (click)="openAddVehicleModal()">
          <span class="plus-icon">+</span> Add Car
        </button>
      </div>

      <div class="vehicles-list">
        <!-- Show vehicle cards only when there are vehicles -->
        <ng-container *ngIf="vehicles && vehicles.length > 0; else emptyState">
          <div
            *ngFor="let vehicle of vehicles"
            class="vehicle-card"
            [class.selected]="selectedVehicleId === vehicle.id"
            [class.default-vehicle]="vehicle.isDefault"
            (click)="selectVehicle(vehicle)"
          >
            <!-- Premium Car Image Section -->
            <div class="premium-image-container">
              <div class="image-gradient-overlay"></div>
              <img
                [src]="getCarImageUrl(vehicle)"
                [alt]="vehicle.make + ' ' + vehicle.model"
                class="premium-car-image"
                (error)="handleImageError($event)"
              />
              
              <!-- Floating Feature Badge -->
              <div *ngIf="vehicle.isDefault" class="floating-badge premium-badge">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
                <span>Premium</span>
              </div>

              <!-- Car Status Badge -->
              <div class="floating-badge status-badge">
                <span class="status-dot"></span>
                Active
              </div>
            </div>

            <!-- Premium Content Section -->
            <div class="premium-card-content">
              <!-- Header with Title and Actions -->
              <div class="premium-header">
                <div class="title-wrapper">
                  <img
                    [src]="getCarLogoUrl(vehicle)"
                    [alt]="vehicle.make + ' logo'"
                    class="car-logo-premium"
                    (error)="handleLogoError($event)"
                  />
                  <div class="title-group">
                    <h2 class="premium-title">{{ vehicle.make }} {{ vehicle.model }}</h2>
                    <p class="premium-subtitle">{{ vehicle.year }} ‚Ä¢ {{ vehicle.licensePlate }}</p>
                  </div>
                </div>
                <div class="action-icons">
                  <button
                    *ngIf="!vehicle.isDefault"
                    class="icon-btn favorite-btn"
                    aria-label="Set as default vehicle"
                    (click)="setDefaultVehicle(vehicle, $event)"
                    title="Set as Default Vehicle"
                  >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                    </svg>
                  </button>
                  <button
                    *ngIf="vehicle.isDefault"
                    class="icon-btn favorite-btn active"
                    aria-label="Unset default vehicle"
                    (click)="unsetDefaultVehicle(vehicle, $event)"
                    title="Unset Default Vehicle"
                  >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                    </svg>
                  </button>
                  <button
                    class="icon-btn edit-icon-btn"
                    aria-label="View details"
                    (click)="navigateToCarDetails(vehicle, $event)"
                    title="View Details"
                  >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                    </svg>
                  </button>
                  <button
                    class="icon-btn delete-icon-btn"
                    aria-label="Delete vehicle"
                    (click)="promptDelete(vehicle, $event)"
                    title="Delete Vehicle"
                  >
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="3 6 5 6 21 6" />
                      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                      <line x1="10" y1="11" x2="10" y2="17" />
                      <line x1="14" y1="11" x2="14" y2="17" />
                    </svg>
                  </button>
                </div>
              </div>

              <!-- Mini Spec Cards Row -->
              <div class="spec-cards-row">
                <div class="spec-card">
                  <span class="spec-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="10" />
                      <polyline points="12 6 12 12 16 14" />
                    </svg>
                  </span>
                  <div class="spec-info">
                    <span class="spec-label">Mileage</span>
                    <span class="spec-value">{{ vehicle.currentMileage | number }}</span>
                  </div>
                </div>
                <div class="spec-card">
                  <span class="spec-icon calendar-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                      <line x1="16" y1="2" x2="16" y2="6" />
                      <line x1="8" y1="2" x2="8" y2="6" />
                      <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                  </span>
                  <div class="spec-info">
                    <span class="spec-label">Year</span>
                    <span class="spec-value">{{ vehicle.year }}</span>
                  </div>
                </div>
                <div class="spec-card">
                  <span class="spec-icon plate-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="2" y="7" width="20" height="10" rx="2" ry="2" />
                      <line x1="7" y1="12" x2="17" y2="12" />
                    </svg>
                  </span>
                  <div class="spec-info">
                    <span class="spec-label">Plate</span>
                    <span class="spec-value">{{ vehicle.licensePlate }}</span>
                  </div>
                </div>
                <div class="spec-card">
                  <span class="spec-icon status-icon">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                  </span>
                  <div class="spec-info">
                    <span class="spec-label">Status</span>
                    <span class="spec-value">Active</span>
                  </div>
                </div>
              </div>

              <!-- Car Indicators Section -->
              <div
                class="premium-indicators"
                *ngIf="vehicle.dashboardIndicators && vehicle.dashboardIndicators.length > 0"
              >
                <div
                  *ngFor="let indicator of vehicle.dashboardIndicators"
                  class="premium-indicator"
                  [class.indicator-good]="
                    getIndicatorStatusByLabel(vehicle, indicator.label) === 'good'
                  "
                  [class.indicator-warning]="
                    getIndicatorStatusByLabel(vehicle, indicator.label) === 'warning'
                  "
                  [class.indicator-critical]="
                    getIndicatorStatusByLabel(vehicle, indicator.label) === 'critical'
                  "
                  [class.indicator-unknown]="
                    getIndicatorStatusByLabel(vehicle, indicator.label) === 'unknown'
                  "
                >
                  <div class="indicator-dot"></div>
                  <span class="indicator-label">{{ indicator.label }}</span>
                  <span class="indicator-value">{{
                    getIndicatorLabelByName(vehicle, indicator.label)
                  }}</span>
                </div>
              </div>
              
              <!-- Placeholder when no indicators -->
              <div
                class="car-indicators-placeholder"
                *ngIf="!vehicle.dashboardIndicators || vehicle.dashboardIndicators.length === 0"
              >
                <p class="placeholder-text">
                  No dashboard indicators selected.
                  <a [routerLink]="['/edit-car', vehicle.id]" class="setup-link">Set up now</a>
                </p>
              </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions">
              <button class="quick-action-btn" (click)="navigateToCarDetails(vehicle, $event)">
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="12" cy="12" r="10" />
                  <polyline points="12 16 16 12 12 8" />
                  <line x1="8" y1="12" x2="16" y2="12" />
                </svg>
                View Details
              </button>
              <button
                class="quick-action-btn quick-action-secondary"
                (click)="bookService(vehicle, $event)"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                  <line x1="16" y1="2" x2="16" y2="6" />
                  <line x1="8" y1="2" x2="8" y2="6" />
                  <line x1="3" y1="10" x2="21" y2="10" />
                </svg>
                Schedule
              </button>
            </div>
          </div>
        </ng-container>

        <!-- Empty state for new users -->
        <ng-template #emptyState>
          <div class="empty-vehicles">
            <svg
              class="empty-icon"
              width="80"
              height="80"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M5 17h-2v-6l2-5h9l4 5v6h-2" />
              <circle cx="7" cy="17" r="2" />
              <circle cx="17" cy="17" r="2" />
              <path d="M5 9l1.5-4.5h7L15 9" />
            </svg>
            <h3>No vehicles yet</h3>
            <p class="empty-text">
              Start by adding your first vehicle to track maintenance and expenses
            </p>
            <button class="empty-cta-btn" (click)="openAddVehicleModal()">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              Add Your First Vehicle
            </button>
          </div>
        </ng-template>
      </div>
    </div>

    <!-- Single Book Service CTA Button -->
    <div class="book-service-cta">
      <div class="cta-content">
        <div class="cta-icon">
          <svg
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
            />
          </svg>
        </div>
        <div class="cta-text">
          <h3>Need Service or Maintenance?</h3>
          <p>Book an appointment with verified workshops near you</p>
        </div>
        <button class="cta-book-btn" (click)="navigateToBooking()">
          <span>Book Now</span>
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="9 18 15 12 9 6" />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Right Column: Minimal Sidebar (Upcoming Maintenance only) -->
  <div class="right-column">
    <!-- Upcoming Maintenance Section -->
    <div class="upcoming-maintenance-section">
      <div class="maintenance-shimmer-bar"></div>

      <div class="maintenance-header">
        <div class="maintenance-icon-wrapper">
          <div class="maintenance-icon-badge">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2.5"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
              />
            </svg>
          </div>
          <div class="maintenance-pulse-ring"></div>
        </div>
        <div class="maintenance-title-wrapper">
          <h3 class="maintenance-title">Upcoming Maintenance</h3>
          <p class="maintenance-subtitle">Stay on schedule</p>
        </div>
        <div class="maintenance-count-badge" *ngIf="selectedCarForBookings === null">
          <span>{{ upcomingBookings.length }}</span>
        </div>
        <div class="maintenance-count-badge" *ngIf="selectedCarForBookings !== null">
          <span>{{ totalBookings }}</span>
        </div>
      </div>

      <div class="maintenance-content">
        <!-- Default View - Prompt to Select a Car -->
        <div *ngIf="selectedCarForBookings === null">
          <!-- Loading State -->
          <div *ngIf="loadingBookings" class="maintenance-loading">
            <svg
              class="loading-spinner"
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"
              />
            </svg>
            <p class="loading-text">Loading vehicles...</p>
          </div>

          <!-- Empty State - No Vehicles -->
          <div *ngIf="!loadingBookings && vehicles.length === 0" class="maintenance-empty">
            <svg
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M5 17h-2v-6l2-5h9l4 5v6h-2" />
              <circle cx="7" cy="17" r="2" />
              <circle cx="17" cy="17" r="2" />
            </svg>
            <p class="empty-title">No Vehicles</p>
            <p class="empty-text">Add a vehicle to view bookings</p>
            <button class="book-now-btn" (click)="openAddVehicleModal()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="12" y1="5" x2="12" y2="19" />
                <line x1="5" y1="12" x2="19" y2="12" />
              </svg>
              Add Vehicle
            </button>
          </div>

          <!-- Prompt to Select a Car -->
          <div
            *ngIf="!loadingBookings && vehicles.length > 0"
            class="maintenance-empty select-car-prompt"
          >
            <svg
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M5 17h-2v-6l2-5h9l4 5v6h-2" />
              <circle cx="7" cy="17" r="2" />
              <circle cx="17" cy="17" r="2" />
            </svg>
            <p class="empty-title">Select a Vehicle</p>
            <p class="empty-text">
              Click on any vehicle card to view its bookings and maintenance schedule
            </p>
            <div class="select-car-hint">
              <svg
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polyline points="15 18 9 12 15 6" />
              </svg>
              <span>Click a car card</span>
            </div>
          </div>
        </div>

        <!-- Show Selected Car Bookings with Pagination -->
        <div *ngIf="selectedCarForBookings !== null">
          <!-- Back Button -->
          <button class="back-to-cars-btn" (click)="backToAllCars()">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="15 18 9 12 15 6" />
            </svg>
            <span>Back to Cars</span>
          </button>

          <!-- Loading State -->
          <div *ngIf="loadingCarBookings" class="maintenance-loading">
            <svg
              class="loading-spinner"
              width="32"
              height="32"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"
              />
            </svg>
            <p class="loading-text">Loading bookings...</p>
          </div>

          <!-- Empty State -->
          <div *ngIf="!loadingCarBookings && carBookings.length === 0" class="maintenance-empty">
            <svg
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M12 6v6l4 2" />
            </svg>
            <p class="empty-title">No Bookings</p>
            <p class="empty-text">This vehicle has no scheduled appointments</p>
            <button class="book-now-btn" (click)="navigateToBooking()">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
              </svg>
              Book Service
            </button>
          </div>

          <!-- Bookings List with Pagination -->
          <div *ngIf="!loadingCarBookings && carBookings.length > 0">
            <div class="maintenance-list">
              <div
                *ngFor="let booking of carBookings"
                class="maintenance-item"
                tabindex="0"
                role="button"
                [attr.aria-label]="
                  booking.serviceName +
                  ' due in ' +
                  booking.daysUntil +
                  ' days - ' +
                  booking.urgency
                "
              >
                <div class="maintenance-item-left">
                  <div
                    class="maintenance-service-icon"
                    [class.urgent-icon]="booking.urgency === 'Urgent'"
                    [class.normal-icon]="booking.urgency === 'Scheduled'"
                  >
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path [attr.d]="getServiceIcon(booking.serviceName)" />
                    </svg>
                  </div>
                  <div class="maintenance-info">
                    <p class="maintenance-service-name">{{ booking.serviceName }}</p>
                    <p class="maintenance-service-category">{{ booking.vehicleLabel }}</p>
                  </div>
                </div>
                <div class="maintenance-item-right">
                  <p class="maintenance-due-date">{{ formatDate(booking.appointmentDate) }}</p>
                  <div
                    class="maintenance-status-badge"
                    [class.urgent]="booking.urgency === 'Urgent'"
                    [class.scheduled]="booking.urgency === 'Scheduled'"
                  >
                    <span class="status-pulse"></span>
                    <span class="status-text">{{ booking.urgency }}</span>
                  </div>
                  <button
                    *ngIf="canCancelBooking(booking)"
                    class="cancel-booking-btn"
                    (click)="openCancelPopup(booking, $event)"
                    [disabled]="cancellingBookingIds.has(booking.id)"
                    [class.cancelling]="cancellingBookingIds.has(booking.id)"
                    title="Cancel this booking (available for 12 hours after booking)"
                  >
                    <svg
                      *ngIf="!cancellingBookingIds.has(booking.id)"
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2.5"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <line x1="18" y1="6" x2="6" y2="18" />
                      <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                    <svg
                      *ngIf="cancellingBookingIds.has(booking.id)"
                      class="cancel-spinner"
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2.5"
                    >
                      <path
                        d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"
                      />
                    </svg>
                    <span>{{
                      cancellingBookingIds.has(booking.id) ? 'Cancelling...' : 'Cancel'
                    }}</span>
                  </button>
                </div>
              </div>
            </div>
            <!-- Pagination Controls -->
            <div class="pagination-wrapper" *ngIf="totalPages > 1">
              <div class="pagination-container">
                <!-- Results Summary -->
                <div class="pagination-info">
                  <span class="showing-text">
                    Showing <strong>{{ getStartRecord() }}</strong> -
                    <strong>{{ getEndRecord() }}</strong> of
                    <strong>{{ totalBookings }}</strong> bookings
                  </span>
                </div>

                <!-- Page Navigation -->
                <div class="pagination-nav">
                  <!-- First Page -->
                  <button
                    class="pagination-btn nav-btn"
                    [disabled]="currentPage === 1"
                    (click)="goToPage(1)"
                    title="First Page"
                  >
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="11 17 6 12 11 7" />
                      <polyline points="18 17 13 12 18 7" />
                    </svg>
                  </button>

                  <!-- Previous Page -->
                  <button
                    class="pagination-btn nav-btn"
                    [disabled]="!hasPreviousPage"
                    (click)="previousPage()"
                    title="Previous Page"
                  >
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M15 18l-6-6 6-6" />
                    </svg>
                  </button>

                  <!-- Page Numbers -->
                  <div class="pagination-pages">
                    <!-- First page always shown -->
                    <button
                      class="page-btn"
                      [class.active]="currentPage === 1"
                      (click)="goToPage(1)"
                    >
                      1
                    </button>

                    <!-- Left ellipsis -->
                    <span class="page-ellipsis" *ngIf="currentPage > 3">...</span>

                    <!-- Pages around current -->
                    <ng-container *ngFor="let page of getVisiblePages()">
                      <button
                        *ngIf="page !== 1 && page !== totalPages"
                        class="page-btn"
                        [class.active]="currentPage === page"
                        (click)="goToPage(page)"
                      >
                        {{ page }}
                      </button>
                    </ng-container>

                    <!-- Right ellipsis -->
                    <span class="page-ellipsis" *ngIf="currentPage < totalPages - 2">...</span>

                    <!-- Last page always shown -->
                    <button
                      *ngIf="totalPages > 1"
                      class="page-btn"
                      [class.active]="currentPage === totalPages"
                      (click)="goToPage(totalPages)"
                    >
                      {{ totalPages }}
                    </button>
                  </div>

                  <!-- Next Page -->
                  <button
                    class="pagination-btn nav-btn"
                    [disabled]="!hasNextPage"
                    (click)="nextPage()"
                    title="Next Page"
                  >
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M9 18l6-6-6-6" />
                    </svg>
                  </button>

                  <!-- Last Page -->
                  <button
                    class="pagination-btn nav-btn"
                    [disabled]="currentPage === totalPages"
                    (click)="goToPage(totalPages)"
                    title="Last Page"
                  >
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <polyline points="13 17 18 12 13 7" />
                      <polyline points="6 17 11 12 6 7" />
                    </svg>
                  </button>
                </div>

                <!-- Page Size Selector -->
                <div class="page-size-selector">
                  <label>Per page:</label>
                  <select [(ngModel)]="pageSize" (ngModelChange)="onPageSizeChange()">
                    <option [value]="3">3</option>
                    <option [value]="5">5</option>
                    <option [value]="10">10</option>
                    <option [value]="15">15</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Book More Services Button (always shown) -->
        <button
          class="view-all-maintenance-btn"
          (click)="navigateToBooking()"
          aria-label="Book more services"
        >
          <span>Book More Services</span>
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="5" y1="12" x2="19" y2="12" />
            <polyline points="12 5 19 12 12 19" />
          </svg>
        </button>
      </div>
    </div>

    <!-- AI Assistant Section -->
    <div class="ai-assistant-section">
      <div class="ai-header">
        <div class="ai-avatar-wrapper">
          <div class="ai-avatar">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M12 2L2 7l10 5 10-5-10-5z" />
              <path d="M2 17l10 5 10-5" />
              <path d="M2 12l10 5 10-5" />
            </svg>
          </div>
          <div class="status-indicator"></div>
        </div>
        <div class="ai-title-wrapper">
          <h3 class="ai-title">AI Assistant</h3>
          <p class="ai-subtitle">Always here to help</p>
        </div>
        <button class="ai-expand-btn" aria-label="Expand assistant">
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
      </div>

      <div class="ai-content">
        <div class="ai-greeting">
          <div class="greeting-icon">üëã</div>
          <p class="greeting-text">
            Hi! I'm your intelligent vehicle assistant. Ask me anything about maintenance,
            performance, or best practices.
          </p>
        </div>

        <div class="suggested-prompts">
          <p class="prompts-label">Quick actions:</p>
          <button class="prompt-chip" (click)="handleAIPrompt('maintenance')">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
              />
            </svg>
            Schedule Maintenance
          </button>
          <button class="prompt-chip" (click)="handleAIPrompt('tips')">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10" />
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
              <line x1="12" y1="17" x2="12.01" y2="17" />
            </svg>
            Get Care Tips
          </button>
          <button class="prompt-chip" (click)="handleAIPrompt('diagnostics')">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12" />
            </svg>
            Check Diagnostics
          </button>
          <button class="prompt-chip" (click)="handleAIPrompt('history')">
            <svg
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="12" cy="12" r="10" />
              <polyline points="12 6 12 12 16 14" />
            </svg>
            View History
          </button>
        </div>

        <div class="ai-input-wrapper">
          <div class="input-container">
            <svg
              class="input-icon"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
            <input
              type="text"
              class="ai-input"
              placeholder="Ask about your vehicles..."
              [(ngModel)]="aiInputText"
              (keyup.enter)="sendAIMessage()"
            />
            <button class="send-btn" (click)="sendAIMessage()" [disabled]="!aiInputText.trim()">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="22" y1="2" x2="11" y2="13" />
                <polygon points="22 2 15 22 11 13 2 9 22 2" />
              </svg>
            </button>
          </div>
        </div>

        <div class="ai-capabilities">
          <div class="capability-item">
            <div class="capability-icon">üîç</div>
            <span>Vehicle insights</span>
          </div>
          <div class="capability-item">
            <div class="capability-icon">üí°</div>
            <span>Smart suggestions</span>
          </div>
          <div class="capability-item">
            <div class="capability-icon">üìä</div>
            <span>Cost analysis</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Tips & News Section -->
    <div class="tips-news-section">
      <div class="tips-header">
        <div class="tips-icon-wrapper">
          <svg
            width="22"
            height="22"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"
            />
            <circle cx="12" cy="12" r="3" />
          </svg>
        </div>
        <div class="tips-title-wrapper">
          <h3 class="tips-title">Tips & News</h3>
          <p class="tips-subtitle">Stay informed</p>
        </div>
        <div class="tips-badge">New</div>
      </div>

      <div class="tips-content">
        <!-- Loading state -->
        <div *ngIf="loadingTips" class="tips-loading">
          <div class="loading-spinner"></div>
          <p>Loading latest car tips...</p>
        </div>

        <!-- Empty state -->
        <div *ngIf="!loadingTips && tips.length === 0" class="tips-empty">
          <p>No tips available at the moment. Please check back later!</p>
        </div>

        <!-- Tips list -->
        <div class="tips-list" *ngIf="!loadingTips && tips.length > 0">
          <div
            class="tip-item"
            *ngFor="let tip of tips; let i = index"
            [class.tip-featured]="i === 0"
            (click)="openTipDetails(tip)"
          >
            <div class="tip-icon-badge" [class]="'badge-' + tip.category">
              <span class="tip-emoji">{{ tip.icon }}</span>
            </div>
            <div class="tip-content-wrapper">
              <div class="tip-header-row">
                <span class="tip-category">{{ tip.category }}</span>
                <span class="tip-time">{{ tip.timeAgo }}</span>
              </div>
              <h4 class="tip-title">{{ tip.title }}</h4>
              <p class="tip-excerpt">{{ tip.excerpt }}</p>
              <div class="tip-footer">
                <span class="tip-read-time">
                  <svg
                    width="12"
                    height="12"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="12" cy="12" r="10" />
                    <polyline points="12 6 12 12 16 14" />
                  </svg>
                  {{ tip.readTime }} min read
                </span>
                <span class="tip-arrow">
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <polyline points="9 18 15 12 9 6" />
                  </svg>
                </span>
              </div>
            </div>
          </div>
        </div>

        <button
          class="view-all-tips-btn"
          (click)="loadMoreTips()"
          [disabled]="loadingTips || displayedTipsCount >= totalTipsLimit"
          *ngIf="!loadingTips && tips.length > 0 && displayedTipsCount < totalTipsLimit"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
          </svg>
          Load More Tips & News ({{ tips.length }}/{{ totalTipsLimit }})
        </button>
        <div class="all-tips-loaded" *ngIf="!loadingTips && tips.length > 0 && displayedTipsCount >= totalTipsLimit">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          All tips loaded ({{ tips.length }})
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Tip Detail Modal -->
<div *ngIf="showTipModal && selectedTip" class="modal-overlay" (click)="closeTipModal()">
  <div class="modal-container tip-modal" (click)="$event.stopPropagation()">
    <div class="tip-modal-header" [ngClass]="'header-' + selectedTip.category.toLowerCase()">
      <!-- Decorative Background Pattern -->
      <div class="header-decoration">
        <div class="decoration-circle decoration-1"></div>
        <div class="decoration-circle decoration-2"></div>
        <div class="decoration-circle decoration-3"></div>
      </div>

      <!-- Large Category Icon -->
      <div class="tip-hero-icon" [ngClass]="'icon-' + selectedTip.category.toLowerCase()">
        <span class="hero-emoji">{{ selectedTip.icon }}</span>
        <div class="icon-glow"></div>
      </div>

      <div class="tip-modal-title-section">
        <div class="tip-category-badge" [ngClass]="'category-' + selectedTip.category.toLowerCase()">
          <span class="category-text">{{ selectedTip.category }}</span>
        </div>
        <h2 class="tip-modal-title">{{ selectedTip.title }}</h2>
      </div>
      <button class="modal-close-btn" (click)="closeTipModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="tip-modal-meta">
      <span class="tip-source">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
        </svg>
        {{ selectedTip.source }}
      </span>
      <span class="tip-meta-divider">‚Ä¢</span>
      <span class="tip-time">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        {{ selectedTip.timeAgo }}
      </span>
      <span class="tip-meta-divider">‚Ä¢</span>
      <span class="tip-read-time">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
          <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
        </svg>
        {{ selectedTip.readTime }} min
      </span>
    </div>

    <div class="tip-modal-content">
      <div class="content-quote-icon">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" opacity="0.1">
          <path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/>
        </svg>
      </div>
      <p class="tip-full-content">{{ selectedTip.content }}</p>
    </div>

    <div class="tip-modal-footer">
      <button *ngIf="selectedTip.url" class="btn-external-link" (click)="openExternalLink(selectedTip.url)">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
          <polyline points="15 3 21 3 21 9"></polyline>
          <line x1="10" y1="14" x2="21" y2="3"></line>
        </svg>
        Read Full Article
      </button>
      <button class="btn-close-modal" (click)="closeTipModal()">Close</button>
    </div>
  </div>
</div>

<!-- Add Vehicle Modal -->
<div *ngIf="isAddVehicleModalOpen" class="modal-overlay" (click)="closeAddVehicleModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <app-add-vehicle-form (close)="closeAddVehicleModal()" (saved)="onVehicleSaved($event)">
    </app-add-vehicle-form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="cancelDelete()">
  <div class="confirm-dialog" (click)="$event.stopPropagation()">
    <h3>Confirm Deletion</h3>
    <p *ngIf="carToDelete">
      Delete <strong>{{ carToDelete.make }} {{ carToDelete.model }}</strong
      >? This action cannot be undone.
    </p>
    <div class="confirm-actions">
      <button class="btn cancel" (click)="cancelDelete()" [disabled]="isDeleting">Cancel</button>
      <button class="btn confirm" (click)="deleteCarConfirmed()" [disabled]="isDeleting">
        {{ isDeleting ? 'Deleting...' : 'Delete' }}
      </button>
    </div>
  </div>
</div>

<!-- Cancel Booking Confirmation Popup -->
<app-confirmation-popup
  [isOpen]="showCancelPopup"
  title="Cancel Booking?"
  [message]="cancelPopupMessage"
  confirmText="Yes, Cancel Booking"
  cancelText="Keep Booking"
  confirmButtonClass="danger"
  [showWarningIcon]="true"
  (confirmed)="onCancelPopupConfirmed()"
  (cancelled)="onCancelPopupClosed()"
>
</app-confirmation-popup>
