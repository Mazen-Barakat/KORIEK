<div class="edit-car-container">
  <!-- Car Information Section -->
  <div class="car-info-section">
    <div class="section-header">
      <span class="car-icon">üöó</span>
      <h2>Car Information</h2>
    </div>
    <p class="section-subtitle">Update your car details</p>

    <!-- Success / Error message -->
    <div *ngIf="message" class="alert" [ngClass]="messageType === 'success' ? 'success' : 'error'">
      {{ message }}
    </div>

    <div class="form-grid">
      <!-- Update Form: 2x2 Grid Layout -->
      <div class="update-form-grid">
        <!-- Engine Capacity -->
        <div class="form-group">
          <label for="engine-capacity">Engine Capacity</label>
          <select 
            id="engine-capacity" 
            [(ngModel)]="updateModel.engineCapacity" 
            class="form-input"
          >
            <option *ngFor="let capacity of engineCapacities" [value]="capacity">
              {{ capacity }} CC
            </option>
          </select>
        </div>

        <!-- Current Mileage -->
        <div class="form-group">
          <label for="current-mileage">Current Mileage (km)</label>
          <input 
            type="number" 
            id="current-mileage" 
            [(ngModel)]="updateModel.currentMileage" 
            class="form-input"
          />
        </div>

        <!-- Transmission Type -->
        <div class="form-group">
          <label for="transmission-type">Transmission Type</label>
          <select 
            id="transmission-type" 
            [(ngModel)]="updateModel.transmissionType" 
            class="form-input"
          >
            <option value="" disabled>Select Transmission</option>
            <option *ngFor="let type of transmissionTypes" [value]="type">
              {{ type }}
            </option>
          </select>
        </div>

        <!-- Fuel Type -->
        <div class="form-group">
          <label for="fuel-type">Fuel Type</label>
          <select 
            id="fuel-type" 
            [(ngModel)]="updateModel.fuelType" 
            class="form-input"
          >
            <option value="" disabled>Select Fuel Type</option>
            <option *ngFor="let fuel of fuelTypes" [value]="fuel">
              {{ fuel }}
            </option>
          </select>
        </div>
      </div>

      <!-- Save Button -->
      <div class="form-actions">
        <button type="button" class="btn-save" (click)="saveVehicleInfo()" [disabled]="isSaving">
          {{ isSaving ? 'Saving...' : 'Save Vehicle Info' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Condition Indicators Section -->
  <div class="indicators-section">
    <div class="indicators-header">
      <div class="section-header">
        <span class="indicator-icon">üîß</span>
        <h2>Condition Indicators</h2>
      </div>
      <button class="btn-save" (click)="addIndicator()">Add Indicator</button>
    </div>
    <p class="section-subtitle">Manage maintenance indicators for your car</p>

    <!-- Existing Indicators -->
    <div class="indicators-title">Existing Indicators</div>

    <!-- Empty State -->
    @if (!indicators || indicators.length === 0) {
      <div class="empty-indicators">
        <p>No indicators yet. Click "Add Indicator" to create one.</p>
      </div>
    }

    <!-- Dynamic Indicators List -->
    @if (indicators && indicators.length > 0) {
      <div class="indicators-list">
        @for (indicator of indicators; track indicator.id) {
          <div class="indicator-card">
            <div class="indicator-header">
              <div class="indicator-name">
                <span class="indicator-emoji">{{ indicator.icon }}</span>
                <span class="indicator-status-badge" 
                      [ngClass]="{
                        'good': indicator.status === 'Good',
                        'attention': indicator.status === 'Attention',
                        'urgent': indicator.status === 'Urgent'
                      }">
                  {{ indicator.status }}
                </span>
              </div>
              <button class="delete-btn" (click)="deleteIndicator(indicator)">
                üóëÔ∏è
              </button>
            </div>

            <div class="indicator-label">{{ indicator.name }}</div>

            <div class="indicator-details">
              <div class="detail-row">
                <span class="detail-label">Last Inspected Date</span>
                <span class="detail-label">Next Inspected Date</span>
                <span class="detail-label">Next Mileage (km)</span>
              </div>
              <div class="detail-row">
                <input type="date" [(ngModel)]="indicator.lastInspectedDate" class="detail-input" />
                <input type="date" [(ngModel)]="indicator.nextInspectedDate" class="detail-input" />
                <input type="number" [(ngModel)]="indicator.nextMileage" class="detail-input" />
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Select Top 4 Indicators Section -->
  <div class="dashboard-section">
    <div class="section-header">
      <span class="dashboard-icon">‚úì</span>
      <h2>Select Top 4 Indicators for Dashboard</h2>
    </div>
    <p class="section-subtitle">Select exactly 4 indicators to display on the car owner dashboard <span class="link-text">(4/4 Selected)</span></p>

    <div class="dashboard-grid">
      <div class="dashboard-card selected">
        <button class="remove-btn">‚úï</button>
        <span class="dashboard-emoji">üõ¢Ô∏è</span>
        <span class="dashboard-label">Oil Change</span>
      </div>

      <div class="dashboard-card selected">
        <button class="remove-btn">‚úï</button>
        <span class="dashboard-emoji">‚öôÔ∏è</span>
        <span class="dashboard-label">Tire Rotation</span>
      </div>

      <div class="dashboard-card selected">
        <button class="remove-btn">‚úï</button>
        <span class="dashboard-emoji">üîã</span>
        <span class="dashboard-label">Battery Health</span>
      </div>

      <div class="dashboard-card selected">
        <button class="remove-btn">‚úï</button>
        <span class="dashboard-emoji">‚ö†Ô∏è</span>
        <span class="dashboard-label">Air Filter</span>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="action-buttons">
    <button class="cancel-btn" (click)="cancel()">
      ‚úï Cancel
    </button>
    <button class="save-btn" (click)="saveChanges()">
      Save Changes
    </button>
  </div>
</div>

<!-- Add Indicator Modal -->
@if (isAddingIndicator) {
  <div class="modal-overlay" (click)="cancelAddIndicator()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Add New Indicator</h3>
        <button class="modal-close-btn" (click)="cancelAddIndicator()">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="indicatorType">Indicator Type</label>
          <select id="indicatorType" [(ngModel)]="newIndicator.indicatorType" class="form-input">
            <option value="">Select an indicator type</option>
            @for (type of indicatorTypeOptions; track type.value) {
              <option [value]="type.value">{{ type.label }}</option>
            }
          </select>
        </div>

        <div class="form-group">
          <label for="lastInspectedDate">Last Inspected Date</label>
          <input type="date" id="lastInspectedDate" [(ngModel)]="newIndicator.lastInspectedDate" class="form-input" />
        </div>

        <div class="form-group">
          <label for="nextInspectedDate">Next Inspected Date</label>
          <input type="date" id="nextInspectedDate" [(ngModel)]="newIndicator.nextInspectedDate" class="form-input" />
        </div>

        <div class="form-group">
          <label for="nextMileage">Next Mileage (km)</label>
          <input type="number" id="nextMileage" [(ngModel)]="newIndicator.nextMileage" class="form-input" min="0" />
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="cancelAddIndicator()">Cancel</button>
        <button class="btn-save" (click)="saveNewIndicator()" [disabled]="isSavingIndicator">
          {{ isSavingIndicator ? 'Saving...' : 'Save Indicator' }}
        </button>
      </div>
    </div>
  </div>
}
