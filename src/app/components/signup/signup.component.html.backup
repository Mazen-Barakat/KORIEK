<div class="signup-container">
  <!-- Floating Particles Background -->
  <div class="particles-bg">
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
    <div class="particle"></div>
  </div>

  <!-- Confetti Animation -->
  <div *ngIf="showConfetti" class="confetti-container" aria-hidden="true">
    <div class="confetti" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]"></div>
  </div>

  <div class="signup-card" [class.shake]="errorMessage">
    <!-- Back Button -->
    <button type="button" class="back-btn" (click)="goBack()">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Back
    </button>

    <h2>Create Account</h2>
    <p class="subtitle">Sign up to get started</p>

    <!-- Role Badge with Spinning Animation -->
    <div *ngIf="selectedRole" class="role-badge">
      <div class="role-badge-content">
        <div class="spinner-container" [class.spinning]="isLoading">
          <div class="spinner-ring"></div>
          <div class="role-icon-wrapper">
            <svg *ngIf="selectedRole === 'CAROWNER'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="role-icon car-icon">
              <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
            </svg>
            <svg *ngIf="selectedRole === 'WORKSHOP'" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" class="role-icon">
              <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
            </svg>
          </div>
        </div>
        <span class="role-text">
          <span>Signing up as:</span>
          <strong>{{ selectedRole === 'CAROWNER' ? 'Car Owner' : 'Workshop' }}</strong>
        </span>
      </div>
    </div>

    <!-- Success Message -->
    <div class="alert alert-success" *ngIf="successMessage">
      {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div class="alert alert-error" *ngIf="errorMessage">
      {{ errorMessage }}
    </div>

    <form [formGroup]="signupForm" (ngSubmit)="onSubmit()">
      <!-- Username Field -->
      <div class="form-group">
        <label for="userName">Username</label>
        <input
          type="text"
          id="userName"
          formControlName="userName"
          placeholder="Enter your username"
          [class.error]="hasError('userName', 'required') || hasError('userName', 'minlength') || hasError('userName', 'pattern')"
        />
        <span class="error-message" *ngIf="hasError('userName', 'required')">
          Username is required
        </span>
        <span class="error-message" *ngIf="hasError('userName', 'minlength')">
          Username must be at least 3 characters
        </span>
        <span class="error-message" *ngIf="hasError('userName', 'pattern')">
          Username must be alphanumeric
        </span>
      </div>

      <!-- Email Field -->
      <div class="form-group">
        <label for="email">Email</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          placeholder="Enter your email"
          [class.error]="hasError('email', 'required') || hasError('email', 'email')"
        />
        <span class="error-message" *ngIf="hasError('email', 'required')">
          Email is required
        </span>
        <span class="error-message" *ngIf="hasError('email', 'email')">
          Please enter a valid email
        </span>
      </div>

      <!-- Password Field -->
      <div class="form-group">
        <label for="password">Password</label>
        <div class="password-input-wrapper">
          <input
            [type]="showPassword ? 'text' : 'password'"
            id="password"
            formControlName="password"
            placeholder="Enter your password"
            [class.error]="hasError('password', 'required') || hasError('password', 'minlength') || hasError('password', 'passwordStrength')"
          />
          <button type="button" class="password-toggle" (click)="togglePasswordVisibility()" tabindex="-1">
            <svg *ngIf="!showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <svg *ngIf="showPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
              <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
          </button>
        </div>
        <span class="error-message" *ngIf="hasError('password', 'required')">
          Password is required
        </span>
        <span class="error-message" *ngIf="hasError('password', 'minlength')">
          Password must be at least 8 characters
        </span>
        <span class="error-message" *ngIf="hasError('password', 'passwordStrength')">
          Password must include uppercase, lowercase, number, and special character
        </span>
      </div>

      <!-- Confirm Password Field -->
      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <div class="password-input-wrapper">
          <input
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword"
            formControlName="confirmPassword"
            placeholder="Confirm your password"
            [class.error]="hasError('confirmPassword', 'required') || hasFormError('passwordMismatch')"
          />
          <button type="button" class="password-toggle" (click)="toggleConfirmPasswordVisibility()" tabindex="-1">
            <svg *ngIf="!showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
            <svg *ngIf="showConfirmPassword" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
              <line x1="1" y1="1" x2="23" y2="23"></line>
            </svg>
          </button>
        </div>
        <span class="error-message" *ngIf="hasError('confirmPassword', 'required')">
          Please confirm your password
        </span>
        <span class="error-message" *ngIf="hasFormError('passwordMismatch')">
          Passwords do not match
        </span>
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        class="submit-btn"
        [disabled]="isLoading"
      >
        <span *ngIf="!isLoading">Sign Up</span>
        <span *ngIf="isLoading">Creating Account...</span>
      </button>

      <!-- Login Link -->
      <p class="login-link">
        Already have an account? <a [routerLink]="['/login']" [queryParams]="{role: selectedRole}">Log in</a>
      </p>
    </form>

    <!-- Divider -->
    <div class="divider">
      <span>Or</span>
    </div>

    <!-- Google Sign-Up Button -->
    <button
      type="button"
      class="google-btn"
      (click)="signUpWithGoogle()"
      [disabled]="!selectedRole || isLoading"
    >
      <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%234285F4' d='M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z'/%3E%3Cpath fill='%2334A853' d='M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z'/%3E%3Cpath fill='%23FBBC05' d='M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z'/%3E%3Cpath fill='%23EA4335' d='M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z'/%3E%3C/svg%3E"
        alt="Google"
        class="google-icon"
      />
      <span *ngIf="!isLoading">Continue with Google</span>
      <span *ngIf="isLoading">Signing up...</span>
    </button>

    <!-- Hidden container for Google SDK -->
    <div id="google-signin-button" style="display: none;"></div>
  </div>
</div>

<!-- Celebration Modal -->
<div *ngIf="showCelebrationModal" class="celebration-overlay">
  <div class="celebration-modal">
    <!-- Animated Background Elements -->
    <div class="celebration-bg">
      <div class="sparkle sparkle-1"></div>
      <div class="sparkle sparkle-2"></div>
      <div class="sparkle sparkle-3"></div>
      <div class="sparkle sparkle-4"></div>
    </div>

    <!-- Lottie Car Animation -->
    <div class="lottie-container">
      <canvas #lottieCanvas class="lottie-canvas"></canvas>
    </div>

    <!-- Success Badge -->
    <div class="success-badge">
      <div class="badge-circle">
        <svg width="60" height="60" viewBox="0 0 60 60">
          <circle cx="30" cy="30" r="28" fill="none" stroke="#6BCF7F" stroke-width="3" class="success-circle"/>
          <path d="M 18 30 L 26 38 L 42 22" fill="none" stroke="#6BCF7F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" class="success-check"/>
        </svg>
      </div>
    </div>

    <!-- Celebration Content -->
    <div class="celebration-content">
      <h2 class="celebration-title">üèÅ You're All Set!</h2>
      <p class="celebration-message">{{ successMessage }}</p>
      <div class="celebration-features">
        <div class="feature-item">
          <span class="feature-icon">üöó</span>
          <span>Track Your Vehicles</span>
        </div>
        <div class="feature-item">
          <span class="feature-icon">‚öôÔ∏è</span>
          <span>Manage Maintenance</span>
        </div>
        <div class="feature-item">
          <span class="feature-icon">üí∞</span>
          <span>Monitor Expenses</span>
        </div>
      </div>
      <div class="celebration-footer">
        <div class="road-line"></div>
        <p class="footer-text">Starting your engine...</p>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="loader-bar">
      <div class="loader-progress"></div>
    </div>
  </div>
</div>
