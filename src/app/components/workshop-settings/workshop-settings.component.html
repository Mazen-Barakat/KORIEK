<div class="settings-page">
  <!-- Header -->
  <div class="settings-header">
    <div class="header-left">
      <button class="back-btn" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="15 18 9 12 15 6"/>
        </svg>
      </button>
      <div class="header-title">
        <h1>Settings</h1>
        <p class="subtitle">Configure preferences for {{ workshopName || 'your workshop' }}</p>
      </div>
    </div>
    <div class="header-right">
      <span class="unsaved-badge" *ngIf="isDirty">Unsaved changes</span>
    </div>
  </div>

  <!-- Loading state -->
  <div class="loading-container" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading settings...</p>
  </div>

  <!-- Main content -->
  <div class="settings-layout" *ngIf="!isLoading">
    <!-- Left navigation -->
    <nav class="settings-nav">
      <ul>
        <li *ngFor="let section of sections"
            [class.active]="activeSection === section.id"
            (click)="selectSection(section.id)">
          <span class="nav-icon">{{ section.icon }}</span>
          <span class="nav-label">{{ section.label }}</span>
          <svg class="nav-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"/>
          </svg>
        </li>
      </ul>
    </nav>

    <!-- Content panel -->
    <div class="settings-content">

      <!-- Account Section -->
      <section *ngIf="activeSection === 'account'" class="settings-section">
        <div class="section-header">
          <h2>Account Settings</h2>
          <p>Manage your owner account information</p>
        </div>
        <div class="form-group">
          <label for="ownerName">Owner Name</label>
          <input type="text" id="ownerName" [(ngModel)]="accountForm.ownerName" (ngModelChange)="markDirty()" placeholder="Enter your name">
        </div>
        <div class="form-group">
          <label for="email">Contact Email</label>
          <input type="email" id="email" [(ngModel)]="accountForm.email" (ngModelChange)="markDirty()" placeholder="email@example.com">
        </div>
        <div class="form-group">
          <label for="phone">Phone Number</label>
          <input type="tel" id="phone" [(ngModel)]="accountForm.phone" (ngModelChange)="markDirty()" placeholder="+20 xxx xxx xxxx">
        </div>
        <div class="form-group">
          <label for="address">Business Address</label>
          <textarea id="address" [(ngModel)]="accountForm.address" (ngModelChange)="markDirty()" rows="2" placeholder="Enter your workshop address"></textarea>
        </div>
        <div class="section-actions">
          <button class="btn-primary" (click)="saveAccount()" [disabled]="isSaving">
            <span *ngIf="!isSaving">Save Account</span>
            <span *ngIf="isSaving">Saving...</span>
          </button>
        </div>
      </section>

      <!-- Workshop Profile Section -->
      <section *ngIf="activeSection === 'profile'" class="settings-section">
        <div class="section-header">
          <h2>Workshop Profile</h2>
          <p>Manage how your workshop appears to customers</p>
        </div>
        <div class="profile-preview-card">
          <div class="preview-icon">üè™</div>
          <div class="preview-info">
            <h3>{{ workshopName || 'Your Workshop' }}</h3>
            <p>{{ accountForm.address || 'No address set' }}</p>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn-secondary" (click)="goToProfile()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            View Public Profile
          </button>
          <button class="btn-primary" (click)="goToEditProfile()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Edit Profile
          </button>
        </div>
      </section>

      <!-- Working Hours Section -->
      <section *ngIf="activeSection === 'hours'" class="settings-section">
        <div class="section-header">
          <h2>Working Hours</h2>
          <p>Set when your workshop is open for bookings</p>
        </div>
        <div class="hours-grid">
          <div class="hours-row header-row">
            <span class="col-day">Day</span>
            <span class="col-time">Open</span>
            <span class="col-time">Close</span>
            <span class="col-closed">Closed</span>
          </div>
          <div class="hours-row" *ngFor="let hour of workingHours" [class.closed-day]="hour.isClosed">
            <span class="col-day">{{ hour.day }}</span>
            <input type="time" class="col-time" [(ngModel)]="hour.from" (ngModelChange)="markDirty()" [disabled]="hour.isClosed">
            <input type="time" class="col-time" [(ngModel)]="hour.to" (ngModelChange)="markDirty()" [disabled]="hour.isClosed">
            <label class="col-closed toggle-label">
              <input type="checkbox" [(ngModel)]="hour.isClosed" (ngModelChange)="markDirty()">
              <span class="toggle-switch"></span>
            </label>
          </div>
        </div>
        <div class="hours-actions">
          <button class="btn-link" (click)="copyToWeekdays('Monday')">Copy Monday to all weekdays</button>
        </div>
        <div class="section-actions">
          <button class="btn-primary" (click)="saveWorkingHours()" [disabled]="isSaving">
            <span *ngIf="!isSaving">Save Hours</span>
            <span *ngIf="isSaving">Saving...</span>
          </button>
        </div>
      </section>

      <!-- Notifications Section -->
      <section *ngIf="activeSection === 'notifications'" class="settings-section">
        <div class="section-header">
          <h2>Notification Preferences</h2>
          <p>Choose how you want to be notified</p>
        </div>
        <div class="notifications-table">
          <div class="notif-row header-row">
            <span class="col-type">Type</span>
            <span class="col-toggle">Push</span>
            <span class="col-toggle">Email</span>
            <span class="col-toggle">SMS</span>
          </div>
          <div class="notif-row" *ngFor="let pref of notificationPrefs">
            <span class="col-type">{{ pref.label }}</span>
            <label class="col-toggle toggle-label">
              <input type="checkbox" [(ngModel)]="pref.push" (ngModelChange)="markDirty()">
              <span class="toggle-switch small"></span>
            </label>
            <label class="col-toggle toggle-label">
              <input type="checkbox" [(ngModel)]="pref.email" (ngModelChange)="markDirty()">
              <span class="toggle-switch small"></span>
            </label>
            <label class="col-toggle toggle-label">
              <input type="checkbox" [(ngModel)]="pref.sms" (ngModelChange)="markDirty()">
              <span class="toggle-switch small"></span>
            </label>
          </div>
        </div>
        <div class="section-actions">
          <button class="btn-secondary" (click)="sendTestNotification()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 2L11 13"/>
              <path d="M22 2L15 22 11 13 2 9l20-7z"/>
            </svg>
            Send Test Notification
          </button>
          <button class="btn-primary" (click)="saveNotifications()" [disabled]="isSaving">
            <span *ngIf="!isSaving">Save Preferences</span>
            <span *ngIf="isSaving">Saving...</span>
          </button>
        </div>
      </section>

      <!-- Team & Staff Section -->
      <section *ngIf="activeSection === 'team'" class="settings-section">
        <div class="section-header">
          <h2>Team & Staff</h2>
          <p>Manage team members and access permissions</p>
        </div>
        <div class="team-list">
          <div class="team-member" *ngFor="let member of teamMembers">
            <div class="member-avatar">{{ member.name.charAt(0) }}</div>
            <div class="member-info">
              <span class="member-name">{{ member.name }}</span>
              <span class="member-email">{{ member.email }}</span>
            </div>
            <span class="member-role badge">{{ member.role }}</span>
          </div>
        </div>
        <div class="section-actions">
          <button class="btn-primary" (click)="inviteTeamMember()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="8.5" cy="7" r="4"/>
              <line x1="20" y1="8" x2="20" y2="14"/>
              <line x1="23" y1="11" x2="17" y2="11"/>
            </svg>
            Invite Team Member
          </button>
        </div>
      </section>

      <!-- Payments & Billing Section -->
      <section *ngIf="activeSection === 'payments'" class="settings-section">
        <div class="section-header">
          <h2>Payments & Billing</h2>
          <p>Manage payment methods and billing preferences</p>
        </div>
        <div class="info-card">
          <div class="info-icon">üí≥</div>
          <div class="info-text">
            <h4>Payment Configuration</h4>
            <p>View and manage your payment settings, payout schedule, and transaction history in the Wallet.</p>
          </div>
        </div>
        <div class="section-actions">
          <button class="btn-primary" (click)="goToWallet()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
              <line x1="1" y1="10" x2="23" y2="10"/>
            </svg>
            Open Wallet
          </button>
        </div>
      </section>

      <!-- Security & Access Section -->
      <section *ngIf="activeSection === 'security'" class="settings-section">
        <div class="section-header">
          <h2>Security & Access</h2>
          <p>Protect your account and manage access</p>
        </div>
        <div class="security-options">
          <div class="security-option">
            <div class="option-info">
              <h4>Two-Factor Authentication</h4>
              <p>Add an extra layer of security to your account</p>
            </div>
            <button class="btn-secondary" (click)="enableTwoFactor()">Enable</button>
          </div>
          <div class="security-option">
            <div class="option-info">
              <h4>Change Password</h4>
              <p>Update your account password</p>
            </div>
            <button class="btn-secondary" (click)="changePassword()">Change</button>
          </div>
          <div class="security-option">
            <div class="option-info">
              <h4>Active Sessions</h4>
              <p>Log out from all other devices</p>
            </div>
            <button class="btn-danger-outline" (click)="logoutAllSessions()">Log Out All</button>
          </div>
        </div>
      </section>

      <!-- Support Section -->
      <section *ngIf="activeSection === 'support'" class="settings-section">
        <div class="section-header">
          <h2>Support</h2>
          <p>Get help and contact us</p>
        </div>
        <div class="support-cards">
          <div class="support-card" (click)="contactSupport()">
            <div class="support-icon">üìß</div>
            <h4>Email Support</h4>
            <p>{{ supportEmail }}</p>
          </div>
          <div class="support-card">
            <div class="support-icon">üìö</div>
            <h4>Help Center</h4>
            <p>Browse FAQs and guides</p>
          </div>
          <div class="support-card">
            <div class="support-icon">üêõ</div>
            <h4>Report a Bug</h4>
            <p>Help us improve</p>
          </div>
        </div>
        <div class="app-info">
          <p>KORIEK Workshop App v1.0.0</p>
          <p class="muted">¬© 2025 KORIEK. All rights reserved.</p>
        </div>
      </section>

    </div>
  </div>
</div>
