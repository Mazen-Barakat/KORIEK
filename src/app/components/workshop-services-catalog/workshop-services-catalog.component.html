<div class="services-catalog">
  <!-- Header Section -->
  <div class="catalog-header">
    <div class="header-content">
      <div class="title-section">
        <h2 class="catalog-title">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
            />
          </svg>
          Services Catalog
        </h2>
        <p class="catalog-subtitle">
          {{ getTotalServicesCount() }} total services
          <span *ngIf="hasActiveFilters()"> · {{ getFilteredServicesCount() }} filtered </span>
          <span *ngIf="workshopId" style="opacity: 0.5; font-size: 0.75em">
            (Workshop: {{ workshopId }})
          </span>
        </p>
      </div>

      <!-- Quick Actions -->
      <div class="header-actions">
        <button type="button" class="btn-action" (click)="expandAll()" title="Expand all sections">
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="7 13 12 18 17 13" />
            <polyline points="7 6 12 11 17 6" />
          </svg>
          Expand All
        </button>
        <button
          type="button"
          class="btn-action"
          (click)="collapseAll()"
          title="Collapse all sections"
        >
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="17 11 12 6 7 11" />
            <polyline points="17 18 12 13 7 18" />
          </svg>
          Collapse All
        </button>
        <button
          type="button"
          class="btn-action btn-toggle-filters"
          [class.active]="showFilters"
          (click)="toggleFilters()"
        >
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" />
          </svg>
          Filters
          <span *ngIf="hasActiveFilters()" class="filter-badge">●</span>
        </button>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-input-wrapper">
        <svg
          class="search-icon"
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="11" cy="11" r="8" />
          <path d="m21 21-4.35-4.35" />
        </svg>
        <input
          type="text"
          class="search-input"
          placeholder="Search services by name or origin..."
          [(ngModel)]="filters.searchTerm"
          (input)="onSearch()"
        />
        <button
          *ngIf="filters.searchTerm"
          type="button"
          class="search-clear"
          (click)="filters.searchTerm = ''; onSearch()"
        >
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M18 6L6 18M6 6l12 12" />
          </svg>
        </button>
      </div>

      <!-- Active Filters Chips -->
      <div *ngIf="hasActiveFilters()" class="active-filters">
        <button type="button" class="filter-chip" (click)="clearFilters()">
          <svg
            width="14"
            height="14"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M18 6L6 18M6 6l12 12" />
          </svg>
          Clear all filters
        </button>
      </div>
    </div>

    <!-- Filter Panel -->
    <div *ngIf="showFilters" class="filters-panel">
      <div class="filter-group">
        <label class="filter-label">Sort By</label>
        <select class="filter-select" [(ngModel)]="filters.sortBy" (change)="onFilterChange()">
          <option value="name">Service Name</option>
          <option value="price">Price (Low to High)</option>
          <option value="duration">Duration</option>
        </select>
      </div>

      <div class="filter-group">
        <label class="filter-label">Price Range</label>
        <div class="price-range-inputs">
          <input
            type="number"
            class="filter-input"
            placeholder="Min"
            [(ngModel)]="filters.priceRange.min"
            (change)="onFilterChange()"
          />
          <span class="price-separator">-</span>
          <input
            type="number"
            class="filter-input"
            placeholder="Max"
            [(ngModel)]="filters.priceRange.max"
            (change)="onFilterChange()"
          />
        </div>
      </div>

      <div class="filter-group">
        <label class="filter-label">View Mode</label>
        <div class="view-mode-toggle">
          <button
            type="button"
            class="view-btn"
            [class.active]="viewMode === 'grid'"
            (click)="viewMode = 'grid'"
          >
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="3" y="3" width="7" height="7" />
              <rect x="14" y="3" width="7" height="7" />
              <rect x="14" y="14" width="7" height="7" />
              <rect x="3" y="14" width="7" height="7" />
            </svg>
            Grid
          </button>
          <button
            type="button"
            class="view-btn"
            [class.active]="viewMode === 'list'"
            (click)="viewMode = 'list'"
          >
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="8" y1="6" x2="21" y2="6" />
              <line x1="8" y1="12" x2="21" y2="12" />
              <line x1="8" y1="18" x2="21" y2="18" />
              <line x1="3" y1="6" x2="3.01" y2="6" />
              <line x1="3" y1="12" x2="3.01" y2="12" />
              <line x1="3" y1="18" x2="3.01" y2="18" />
            </svg>
            List
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-state">
    <div class="loading-spinner"></div>
    <p *ngIf="loadingProfile">Loading workshop profile...</p>
    <p *ngIf="!loadingProfile && loading">Loading services...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading()" class="error-state">
    <svg
      width="48"
      height="48"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
    >
      <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
    <h3>Error Loading Services</h3>
    <p>{{ error }}</p>
    <button type="button" class="btn-retry" (click)="retry()">
      <svg
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <polyline points="23 4 23 10 17 10" />
        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10" />
      </svg>
      Retry
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading() && !error && getTotalServicesCount() === 0" class="empty-state">
    <svg
      width="64"
      height="64"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path
        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
      />
    </svg>
    <h3>No Services Yet</h3>
    <p>Start adding services to your workshop to see them here.</p>
  </div>

  <!-- No Results State -->
  <div
    *ngIf="
      !isLoading() && !error && getTotalServicesCount() > 0 && getFilteredServicesCount() === 0
    "
    class="empty-state"
  >
    <svg
      width="64"
      height="64"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <circle cx="11" cy="11" r="8" />
      <path d="m21 21-4.35-4.35" />
    </svg>
    <h3>No Services Found</h3>
    <p>Try adjusting your search or filters.</p>
    <button type="button" class="btn-clear-filters" (click)="clearFilters()">Clear Filters</button>
  </div>

  <!-- Services Content -->
  <div *ngIf="!isLoading() && !error && getFilteredServicesCount() > 0" class="services-content">
    <!-- Origin Sections -->
    <div *ngFor="let origin of getOriginsList()" class="origin-section">
      <!-- Origin Header -->
      <div
        class="origin-header"
        [class.expanded]="isOriginExpanded(origin)"
        (click)="toggleOrigin(origin)"
      >
        <div class="origin-info">
          <span class="origin-flag">{{ getOriginInfo(origin).flag }}</span>
          <h3 class="origin-name">{{ getOriginInfo(origin).name }}</h3>
          <span class="origin-count">{{ getServiceCount(origin) }} services</span>
        </div>
        <button type="button" class="origin-toggle">
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            [class.rotated]="isOriginExpanded(origin)"
          >
            <polyline points="6 9 12 15 18 9" />
          </svg>
        </button>
      </div>

      <!-- Services Grid/List -->
      <div
        *ngIf="isOriginExpanded(origin)"
        class="services-container"
        [class.grid-view]="viewMode === 'grid'"
        [class.list-view]="viewMode === 'list'"
      >
        <div
          *ngFor="let service of filteredGroupedServices[origin]"
          class="service-card"
          [class.deleting]="deletingServiceId === service.id"
        >
          <!-- Service Header -->
          <div class="service-header">
            <div class="service-title-section">
              <h4 class="service-name">
                {{ service.serviceName || 'Service #' + service.serviceId }}
              </h4>
              <span class="service-badge">{{ getOriginInfo(service.origin).name }}</span>
            </div>
            <div class="service-actions">
              <button
                type="button"
                class="btn-service-action btn-edit"
                (click)="onEditService(service)"
                title="Edit service"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                  <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                </svg>
              </button>
              <button
                type="button"
                class="btn-service-action btn-delete"
                (click)="onDeleteService(service.id)"
                title="Delete service"
              >
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="3 6 5 6 21 6" />
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  />
                </svg>
              </button>
            </div>
          </div>

          <!-- Service Details -->
          <div class="service-body">
            <p *ngIf="service.serviceDescription" class="service-description">
              {{ service.serviceDescription }}
            </p>
            <div class="service-detail">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
              </svg>
              <span>{{ service.duration }} minutes</span>
            </div>
            <div class="service-detail">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="12" y1="1" x2="12" y2="23" />
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
              </svg>
              <span>${{ service.minPrice }} - ${{ service.maxPrice }}</span>
            </div>
          </div>

          <!-- Delete Confirmation -->
          <div *ngIf="deletingServiceId === service.id" class="delete-confirmation">
            <p>Delete this service?</p>
            <div class="delete-actions">
              <button type="button" class="btn-confirm-delete" (click)="confirmDelete()">
                Delete
              </button>
              <button type="button" class="btn-cancel-delete" (click)="cancelDelete()">
                Cancel
              </button>
            </div>
            <div class="delete-timer">Auto-cancels in 5s</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination Controls -->
  <div *ngIf="totalPages > 1" class="pagination-controls">
    <div class="pagination-info">
      <span
        >Showing {{ (currentPage - 1) * pageSize + 1 }} -
        {{ Math.min(currentPage * pageSize, totalRecords) }} of {{ totalRecords }} services</span
      >
    </div>
    <div class="pagination-buttons">
      <button
        type="button"
        class="btn-pagination btn-prev"
        [disabled]="!hasPreviousPage || loading"
        (click)="previousPage()"
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M15 18l-6-6 6-6" />
        </svg>
        Previous
      </button>

      <div class="pagination-pages">
        <button
          *ngFor="let page of [].constructor(totalPages); let i = index"
          type="button"
          class="btn-page"
          [class.active]="currentPage === i + 1"
          [disabled]="loading"
          (click)="goToPage(i + 1)"
        >
          {{ i + 1 }}
        </button>
      </div>

      <button
        type="button"
        class="btn-pagination btn-next"
        [disabled]="!hasNextPage || loading"
        (click)="nextPage()"
      >
        Next
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M9 18l6-6-6-6" />
        </svg>
      </button>
    </div>
  </div>
</div>
