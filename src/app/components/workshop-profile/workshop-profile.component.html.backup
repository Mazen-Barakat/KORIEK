<div class="workshop-profile-page">
  <!-- Header Section removed - Edit button is in the hero card for owners -->

  <!-- Workshop Hero -->
  <div class="workshop-hero" [style.background-image]="'url(' + workshop.headerImage + ')'">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <!-- Owner-only edit button inside the dark hero card -->
      <button *ngIf="isOwner" class="hero-edit-btn" (click)="editProfile()" aria-label="Edit Workshop Profile">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
        </svg>
        Edit Profile
      </button>
      <div class="workshop-avatar">
        <img *ngIf="workshop.logoUrl" [src]="workshop.logoUrl" alt="{{ workshop.name }} logo" class="workshop-logo-img">
        <span *ngIf="!workshop.logoUrl">{{ workshop.initials }}</span>
      </div>
      <div class="workshop-main-info">
        <div class="workshop-title-row">
          <h1 class="workshop-name">{{ workshop.name }}</h1>
          <svg *ngIf="workshop.verified" class="verified-badge" width="24" height="24" viewBox="0 0 24 24" fill="#3b82f6">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="workshop-meta">
          <div class="rating">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#fbbf24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span class="rating-value">{{ workshop.rating }}</span>
            <span class="review-count">({{ workshop.reviewCount }} reviews)</span>
          </div>
          <span class="separator">•</span>
          <span class="workshop-type">{{ workshop.type }}</span>
          <span class="separator">•</span>
          <div class="location">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            {{ workshop.location }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar -->
    <aside class="sidebar">
      <!-- Status Card removed (merged into contact card) -->

      <!-- Contact + Links Card (merged) -->
      <div class="info-card contact-card">
        <div class="status-row" style="margin-bottom:0.75rem;">
          <div class="status-indicator" [class.open]="workshop.status === 'open'">
            <span class="status-dot"></span>
            <span class="status-text">{{ workshop.status === 'open' ? 'Open Now' : 'Closed' }}</span>
          </div>
          <div class="closing-time" *ngIf="workshop.status === 'open'">
            Closes {{ workshop.closingTime }}
          </div>
        </div>

        <div class="contact-actions">
          <button class="contact-btn phone-btn" (click)="makePhoneCall()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            {{ workshop.phone }}
          </button>

          <button class="contact-btn directions-btn" (click)="getDirections()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
            </svg>
            Get Directions
          </button>
        </div>

        <div class="contact-links" style="margin-top:1rem;border-top:1px solid #f3f4f6;padding-top:1rem;">
          <div class="info-row">
            <span class="label">Website:</span>
            <a class="link" (click)="visitWebsite()">{{ workshop.website }}</a>
          </div>
          <div class="info-row" style="margin-top:0.5rem;">
            <span class="label">Email:</span>
            <a class="link" (click)="sendEmail()">{{ workshop.email }}</a>
          </div>
        </div>
      </div>

      <!-- About Workshop -->
      <div class="info-card about-card">
        <h3 class="card-title">About Workshop</h3>
        <p class="about-text">{{ workshop.about }}</p>
        <div class="workshop-stats">
          <div class="stat-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            <div class="stat-info">
              <span class="stat-label">Techs</span>
              <span class="stat-value">{{ workshop.techCount }}</span>
            </div>
          </div>
          <div class="stat-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <div class="stat-info">
              <span class="stat-label">Type</span>
              <span class="stat-value">{{ workshop.type }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Working Hours -->
      <div class="info-card hours-card">
        <h3 class="card-title">Working Hours</h3>
        <div class="hours-list">
          <div class="hour-row" *ngFor="let day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']" [class.closed]="isWorkingHoursClosed(day)">
            <span class="day-name">{{ day }}</span>
            <span class="day-hours">{{ formatWorkingHours(day) }}</span>
          </div>
        </div>
      </div>

      <!-- Gallery -->
      <div class="info-card gallery-card">
        <div class="gallery-header">
          <h3 class="card-title">Gallery</h3>
          <button class="view-all-btn">View All</button>
        </div>
        <div class="gallery-grid">
          <div class="gallery-item" *ngFor="let image of workshop.gallery.slice(0, 4)">
            <img [src]="image" [alt]="workshop.name + ' gallery'">
          </div>
        </div>
      </div>
    </aside>

    <!-- Content Area -->
    <main class="content-area">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab" [class.active]="selectedTab === 'services'" (click)="switchTab('services')">
          Services Menu
        </button>
        <button class="tab" [class.active]="selectedTab === 'reviews'" (click)="switchTab('reviews')">
          Reviews ({{ workshop.reviewCount }})
        </button>
      </div>

      <!-- Services Tab -->
      <div class="tab-content" *ngIf="selectedTab === 'services'">
        <div class="services-header">
          <h2 class="section-title">Select Services</h2>
          <div style="display:flex;align-items:center;gap:1rem;">
            <span class="available-count">{{ workshop.services.length }} available</span>
            <button *ngIf="isOwner" class="btn btn-primary add-service-btn" (click)="startAddService()">+ Add Service</button>
          </div>
        </div>

        <!-- Admin: Add / Edit Service Form -->
        <div *ngIf="isOwner && (editingService !== null || serviceForm.name)" class="service-form info-card">
          <h3 class="card-title">{{ editingService ? 'Edit Service' : 'Add Service' }}</h3>
          <div class="form-row">
            <label>Name</label>
            <input [(ngModel)]="serviceForm.name" placeholder="Service name" />
          </div>
          <div class="form-row">
            <label>Description</label>
            <textarea [(ngModel)]="serviceForm.description" placeholder="Short description"></textarea>
          </div>
          <div class="form-row">
            <label>Duration (minutes)</label>
            <input type="number" [(ngModel)]="serviceForm.duration" />
          </div>
          <div class="form-row two-cols">
            <div>
              <label>Min Price (EGP)</label>
              <input type="number" [(ngModel)]="serviceForm.minPrice" />
            </div>
            <div>
              <label>Max Price (EGP)</label>
              <input type="number" [(ngModel)]="serviceForm.maxPrice" />
            </div>
          </div>
          <div class="form-row">
            <label>Image URL</label>
            <input [(ngModel)]="serviceForm.imageUrl" placeholder="assets/images/example.jpg" />
          </div>
          <div style="display:flex;gap:0.75rem;margin-top:0.75rem;">
            <button class="btn btn-primary" (click)="saveService()">Save</button>
            <button class="btn" (click)="cancelEdit()">Cancel</button>
          </div>
        </div>

        <div *ngIf="workshop.services.length === 0" class="info-card">
          <p style="margin:0 0.5rem;">No services have been added yet.</p>
          <p style="margin:0.5rem 0 0 0;color:var(--muted);font-size:0.95rem;">Workshop owners can add services to their catalog.</p>
        </div>

        <div class="services-list" *ngIf="workshop.services.length > 0">
          <div class="service-card" *ngFor="let service of workshop.services" [class.selected]="service.selected">
            <div class="service-info">
              <h3 class="service-name">{{ service.name }}</h3>
              <p class="service-description">{{ service.description }}</p>
              <div class="service-meta">
                <span class="duration">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                  </svg>
                  {{ formatDuration(service.duration) }}
                </span>
              </div>
            </div>
            <div class="service-action">
              <span class="service-price">{{ service.minPrice }} - {{ service.maxPrice }} <span class="currency">EGP</span></span>
              <div style="display:flex;gap:0.5rem;align-items:center;">
                <button *ngIf="isOwner" class="btn" (click)="startEditService(service)">Edit</button>
                <button *ngIf="isOwner" class="btn" (click)="deleteService(service)">Delete</button>
                <button class="select-btn" [class.selected]="service.selected" (click)="toggleServiceSelection(service)">
                  <span *ngIf="!service.selected" class="plus-icon">+</span>
                  <svg *ngIf="service.selected" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3">
                    <path d="M5 13l4 4L19 7"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reviews Tab -->
      <div class="tab-content" *ngIf="selectedTab === 'reviews'">
        <div class="reviews-placeholder">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <h3>Reviews Coming Soon</h3>
          <p>Customer reviews and ratings will be displayed here.</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Booking Footer -->
  <div class="booking-footer" *ngIf="selectedServiceCount > 0">
    <div class="footer-content">
      <div class="estimate-info">
        <div class="estimate-label">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <span>Total Estimate</span>
        </div>
        <div class="estimate-value">
          <span class="amount">{{ totalEstimate }}</span>
          <span class="currency">EGP</span>
        </div>
      </div>
      <div class="selected-info">
        <span class="selected-count">{{ selectedServiceCount }} Services</span>
      </div>
      <button class="book-btn" (click)="bookAppointment()">
        Book Appointment
      </button>
    </div>
  </div>
</div>
