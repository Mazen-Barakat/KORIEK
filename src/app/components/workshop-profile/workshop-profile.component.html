<div class="workshop-profile-page">
  <!-- Workshop Hero -->
  <div class="workshop-hero" [style.background-image]="'url(assets/images/workshop-hero.jpg)'">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <!-- Edit button - backend handles permissions -->
      <button class="hero-edit-btn" (click)="editProfile()" aria-label="Edit Workshop Profile">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
        </svg>
        Edit Profile
      </button>
      <div class="workshop-avatar">
        <img *ngIf="profileData.logoImageUrl" [src]="buildAssetUrl(profileData.logoImageUrl)" alt="{{ profileData.name }} logo" class="workshop-logo-img">
        <span *ngIf="!profileData.logoImageUrl">{{ generateInitials(profileData.name) }}</span>
      </div>
      <div class="workshop-main-info">
        <div class="workshop-title-row">
          <h1 class="workshop-name">{{ profileData.name || 'Workshop Name' }}</h1>
          <svg *ngIf="profileData.verificationStatus === 'Verified'" class="verified-badge" width="24" height="24" viewBox="0 0 24 24" fill="#3b82f6">
            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="workshop-meta">
          <div class="rating">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="#fbbf24">
              <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span class="rating-value">{{ profileData.rating || 0 }}</span>
            <span class="review-count">(0 reviews)</span>
          </div>
          <span class="separator">•</span>
          <span class="workshop-type">{{ profileData.workShopType || 'Workshop' }}</span>
          <span class="separator">•</span>
          <div class="location">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z"/>
              <circle cx="12" cy="10" r="3"/>
            </svg>
            {{ getLocation() }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar -->
    <aside class="sidebar">
      <!-- Contact Card -->
      <div class="info-card contact-card">
        <div class="status-row" style="margin-bottom:0.75rem;">
          <div class="status-indicator closed">
            <span class="status-dot"></span>
            <span class="status-text">Closed</span>
          </div>
        </div>

        <div class="contact-actions">
          <button class="contact-btn phone-btn" (click)="makePhoneCall()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
            {{ profileData.phoneNumber || 'Not provided' }}
          </button>

          <!-- Direct link when lat/lng are available -->
          <a class="contact-btn directions-btn"
             *ngIf="profileData?.latitude && profileData?.longitude"
             [href]="'https://www.google.com/maps/dir/?api=1&destination=' + profileData.latitude + ',' + profileData.longitude"
             target="_blank" rel="noopener noreferrer">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
            </svg>
            Get Directions
          </a>
          <!-- Fallback button when lat/lng are missing -->
          <button class="contact-btn directions-btn" 
                  *ngIf="!profileData?.latitude || !profileData?.longitude"
                  (click)="getDirections()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/>
            </svg>
            Get Directions
          </button>
        </div>

        <div class="contact-links" style="margin-top:1rem;border-top:1px solid #f3f4f6;padding-top:1rem;">
          <div class="info-row">
            <span class="label">Website:</span>
            <a class="link" (click)="visitWebsite()">{{ profileData.website || 'Not provided' }}</a>
          </div>
          <div class="info-row" style="margin-top:0.5rem;">
            <span class="label">Email:</span>
            <a class="link" (click)="sendEmail()">{{ profileData.email || 'Not provided' }}</a>
          </div>
        </div>
      </div>

      <!-- About Workshop -->
      <div class="info-card about-card">
        <h3 class="card-title">About Workshop</h3>
        <p class="about-text">{{ profileData.description || 'No description provided yet.' }}</p>
        <div class="workshop-stats">
          <div class="stat-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
            <div class="stat-info">
              <span class="stat-label">Techs</span>
              <span class="stat-value">{{ profileData.numbersOfTechnicians || 0 }}</span>
            </div>
          </div>
          <div class="stat-item">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
            <div class="stat-info">
              <span class="stat-label">Type</span>
              <span class="stat-value">{{ profileData.workShopType || 'Not specified' }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Working Hours -->
      <div class="info-card hours-card">
        <h3 class="card-title">Working Hours</h3>
        <div class="hours-list">
          <div class="hour-row" *ngFor="let day of ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']" [class.closed]="isWorkingHoursClosed(day)">
            <span class="day-name">{{ day }}</span>
            <span class="day-hours">{{ formatWorkingHours(day) }}</span>
          </div>
        </div>
      </div>

      <!-- Gallery -->
      <div class="info-card gallery-card" *ngIf="photos.length > 0">
        <div class="gallery-header">
          <h3 class="card-title">Gallery</h3>
          <button class="view-all-btn">View All</button>
        </div>
        <div class="gallery-grid">
          <div class="gallery-item" *ngFor="let photo of photos.slice(0, 4)">
            <img [src]="buildAssetUrl(photo)" alt="Workshop photo">
          </div>
        </div>
      </div>
    </aside>

    <!-- Content Area -->
    <main class="content-area">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab" [class.active]="selectedTab === 'services'" (click)="switchTab('services')">
          Services Menu
        </button>
        <button class="tab" [class.active]="selectedTab === 'reviews'" (click)="switchTab('reviews')">
          Reviews (0)
        </button>
      </div>

      <!-- Services Tab -->
      <div class="tab-content" *ngIf="selectedTab === 'services'">
        <!-- Premium Services Header -->
        <div class="services-header-premium">
          <div class="header-content-wrapper">
            <div class="title-section">
              <div class="title-with-badge">
                <h2 class="section-title-premium">Service Portfolio</h2>
                <span class="new-badge" *ngIf="services.length === 0">New</span>
              </div>
              <p class="section-subtitle">Showcase your expertise with a professional service catalog</p>
            </div>
            <div class="actions-section">
              <div class="stats-card">
                <div class="stat-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                  </svg>
                </div>
                <div class="stat-content">
                  <span class="stat-number">{{ services.length }}</span>
                  <span class="stat-label">Active Services</span>
                </div>
              </div>
              <button class="btn-add-premium" (click)="openAddServiceModal()">
                <span class="btn-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                </span>
                <span class="btn-text">Add Services</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Premium Empty State -->
        <div *ngIf="services.length === 0" class="empty-state-premium">
          <div class="empty-content">
            <div class="empty-illustration">
              <div class="illustration-bg"></div>
              <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
              </svg>
            </div>
            <div class="empty-text">
              <h3 class="empty-heading">Build Your Service Catalog</h3>
              <p class="empty-message">Create a professional portfolio of services to attract more customers and grow your business.</p>
            </div>
            <button class="btn-cta-primary" (click)="openAddServiceModal()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                <path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              <span>Create Your First Service</span>
            </button>
            <div class="features-grid">
              <div class="feature-card">
                <div class="feature-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 7v4a1 1 0 001 1h3m0-5v10m0-10L4 3m3 4l3-4m10 18v-4a1 1 0 00-1-1h-3m0 5v-10m0 10l3 4m-3-4l-3 4"/>
                  </svg>
                </div>
                <div class="feature-text">
                  <h4>Smart Categorization</h4>
                  <p>200+ pre-configured services across 7 categories</p>
                </div>
              </div>
              <div class="feature-card">
                <div class="feature-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <div class="feature-text">
                  <h4>Flexible Pricing</h4>
                  <p>Set custom price ranges and service durations</p>
                </div>
              </div>
              <div class="feature-card">
                <div class="feature-icon">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                </div>
                <div class="feature-text">
                  <h4>Car Specialization</h4>
                  <p>Specify expertise by vehicle origin and brand</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Premium Services Grid -->
        <div class="services-grid-premium" *ngIf="services.length > 0">
          <div class="service-card-premium" *ngFor="let service of services" [class.is-selected]="service.selected">
            <!-- Card Accent Line -->
            <div class="card-accent"></div>
            
            <!-- Card Header -->
            <div class="card-header-premium">
              <div class="service-icon-wrapper">
                <div class="service-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 6v6l4 2"/>
                    <circle cx="12" cy="12" r="10"/>
                  </svg>
                </div>
                <div class="availability-badge" [class.active]="service.isAvailable">
                  <span class="badge-dot"></span>
                </div>
              </div>
              <div class="card-actions">
                <button class="action-btn-circle" (click)="startEditService(service)" title="Edit Service">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/>
                    <path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/>
                  </svg>
                </button>
                <button class="action-btn-circle danger" (click)="deleteService(service)" title="Delete Service">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Card Body -->
            <div class="card-body-premium">
              <h3 class="service-title-premium">{{ service.name }}</h3>
              <p class="service-description-premium" *ngIf="service.description">{{ service.description }}</p>
              
              <!-- Service Details Grid -->
              <div class="service-details-grid">
                <div class="detail-item">
                  <div class="detail-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <polyline points="12 6 12 12 16 14"/>
                    </svg>
                  </div>
                  <div class="detail-content">
                    <span class="detail-label">Duration</span>
                    <span class="detail-value">{{ formatDuration(service.duration) }}</span>
                  </div>
                </div>
                <div class="detail-item">
                  <div class="detail-icon price-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 1v22M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
                    </svg>
                  </div>
                  <div class="detail-content">
                    <span class="detail-label">Price Range</span>
                    <span class="detail-value price-value">{{ service.minPrice }} - {{ service.maxPrice }} <span class="currency">EGP</span></span>
                  </div>
                </div>
              </div>

              <!-- Car Specializations -->
              <div class="specializations-section" *ngIf="service.carOriginSpecializations && service.carOriginSpecializations.length > 0">
                <div class="specializations-label">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                  </svg>
                  <span>Specializations</span>
                </div>
                <div class="specialization-chips">
                  <span class="chip" *ngFor="let origin of service.carOriginSpecializations.slice(0, 3)">
                    <span class="chip-flag">{{ getOriginFlag(origin) }}</span>
                    <span class="chip-text">{{ getOriginName(origin) }}</span>
                  </span>
                  <span class="chip chip-more" *ngIf="service.carOriginSpecializations.length > 3" [title]="getRemainingOrigins(service)">
                    <span class="chip-text">+{{ service.carOriginSpecializations.length - 3 }}</span>
                  </span>
                </div>
              </div>
            </div>

            <!-- Card Footer -->
            <div class="card-footer-premium">
              <div class="status-indicator">
                <span class="status-text" [class.active]="service.isAvailable">{{ service.isAvailable ? 'Available Now' : 'Unavailable' }}</span>
              </div>
              <button class="select-btn-premium" [class.is-selected]="service.selected" (click)="toggleServiceSelection(service)">
                <span class="select-icon">
                  <svg *ngIf="!service.selected" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                  </svg>
                  <svg *ngIf="service.selected" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                    <path d="M5 13l4 4L19 7"/>
                  </svg>
                </span>
                <span class="select-text">{{ service.selected ? 'Selected' : 'Select Service' }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Reviews Tab -->
      <div class="tab-content" *ngIf="selectedTab === 'reviews'">
        <div class="reviews-placeholder">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#9ca3af" stroke-width="1.5">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <h3>Reviews Coming Soon</h3>
          <p>Customer reviews and ratings will be displayed here.</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Booking Footer -->
  <div class="booking-footer" *ngIf="selectedServiceCount > 0">
    <div class="footer-content">
      <div class="estimate-info">
        <div class="estimate-label">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <span>Total Estimate</span>
        </div>
        <div class="estimate-value">
          <span class="amount">{{ totalEstimate }}</span>
          <span class="currency">EGP</span>
        </div>
      </div>
      <div class="selected-info">
        <span class="selected-count">{{ selectedServiceCount }} Services</span>
      </div>
      <button class="book-btn" (click)="bookAppointment()">
        Book Appointment
      </button>
    </div>
  </div>
</div>

<!-- Error state -->
<div *ngIf="errorMessage" style="display: flex; justify-content: center; align-items: center; min-height: 400px; flex-direction: column; gap: 1rem;">
  <p style="color: #ef4444; font-size: 1.125rem;">{{ errorMessage }}</p>
  <button class="btn btn-primary" (click)="loadWorkshopData()">Retry</button>
</div>

<!-- Add Service Modal -->
<app-add-service-modal
  *ngIf="showAddServiceModal"
  (close)="closeAddServiceModal()"
  (servicesAdded)="handleServicesAdded($event)"
></app-add-service-modal>

<!-- Floating Action Button for Add Service -->
<button 
  *ngIf="profileData && profileData.id && selectedTab === 'services'"
  class="fab-add-service"
  (click)="openAddServiceModal()"
  title="Add Services"
>
  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
    <path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
  </svg>
</button>
